import{D as C,W as S,r as b,J as D,O as M,g as N,p as h,H as V,a as d,c as _,b as a,d as o,i as u,e as r,m,v as B,f as K,$ as y,z as E}from"./index-CM1Y3Pe1.js";import{L as n}from"./localeText-DQo_Zwde.js";import{B as F,N as q,b as O,A as R,E as U,D as W,a as $,M as z,P as G}from"./bulkAdd-DhYJDZFt.js";const L={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll",ref:"editConfigurationContainer"},T={class:"container d-flex h-100 w-100"},H={class:"m-auto modal-dialog-centered dashboardModal",style:{width:"1000px"}},J={class:"card rounded-3 shadow flex-grow-1"},j={class:"card-header bg-transparent d-flex align-items-center gap-2 border-0 p-4"},Q={class:"mb-0"},X={class:"card-body px-4 pb-4"},Y={class:"d-flex flex-column gap-2"},Z={class:"row gy-3"},ee={key:0,class:"col-sm"},ae={class:"col-sm"},le={class:"col-sm"},te={key:1,class:"col-12"},se={class:"form-check form-switch"},de={class:"form-check-label",for:"bullAdd_PresharedKey_Switch"},oe={class:"fw-bold"},ne={key:0},ie={class:"form-label d-block"},ue={class:"text-muted"},re={class:"btn-group",role:"group"},ce={class:"btn btn-outline-primary btn-sm",for:"advanced_security_on"},ve={class:"btn btn-outline-primary btn-sm",for:"advanced_security_off"},_e={class:"d-flex mt-2"},pe=["disabled"],be={key:0,class:"bi bi-plus-circle-fill me-2"},he={__name:"peerAddModal",emits:["close"],async setup(me,{emit:A}){let f,k;const c=C(),w=S(),e=b({bulkAdd:!1,bulkAddAmount:0,name:"",allowed_ips:[],private_key:"",public_key:"",DNS:c.Configuration.Peers.peer_global_dns,endpoint_allowed_ip:c.Configuration.Peers.peer_endpoint_allowed_ip,keepalive:parseInt(c.Configuration.Peers.peer_keep_alive),mtu:parseInt(c.Configuration.Peers.peer_mtu),preshared_key:"",preshared_key_bulkAdd:!1,advanced_security:"off",override_allowed_ips:!1}),v=b([]),t=b(!1),p=D();[f,k]=M(()=>N("/api/getAvailableIPs/"+p.params.id,{},s=>{s.status&&(v.value=s.data)})),await f,k();const g=A,P=h(()=>w.Configurations.find(s=>s.Name===p.params.id).Protocol),x=h(()=>{let s=!0;return e.value.bulkAdd?(e.value.bulkAddAmount.length===0||e.value.bulkAddAmount>v.value.length)&&(s=!1):["allowed_ips","private_key","public_key","endpoint_allowed_ip","keepalive","mtu"].forEach(i=>{e.value[i].length===0&&(s=!1)}),s}),I=()=>{t.value=!0,E("/api/addPeers/"+p.params.id,e.value,s=>{s.status?(c.newMessage("Server","Peer created successfully","success"),g("addedPeers")):c.newMessage("Server",s.message,"danger"),t.value=!1})};return V(()=>e.value.bulkAddAmount,()=>{e.value.bulkAddAmount>v.value.length&&(e.value.bulkAddAmount=v.value.length)}),(s,l)=>(d(),_("div",L,[a("div",T,[a("div",H,[a("div",J,[a("div",j,[a("h4",Q,[o(n,{t:"Add Peers"})]),a("button",{type:"button",class:"btn-close ms-auto",onClick:l[0]||(l[0]=i=>g("close"))})]),a("div",X,[a("div",Y,[o(F,{saving:t.value,data:e.value,availableIp:v.value},null,8,["saving","data","availableIp"]),l[5]||(l[5]=a("hr",{class:"mb-0 mt-2"},null,-1)),e.value.bulkAdd?r("",!0):(d(),u(q,{key:0,saving:t.value,data:e.value},null,8,["saving","data"])),e.value.bulkAdd?r("",!0):(d(),u(O,{key:1,saving:t.value,data:e.value},null,8,["saving","data"])),e.value.bulkAdd?r("",!0):(d(),u(R,{key:2,availableIp:v.value,saving:t.value,data:e.value},null,8,["availableIp","saving","data"])),o(U,{saving:t.value,data:e.value},null,8,["saving","data"]),o(W,{saving:t.value,data:e.value},null,8,["saving","data"])]),l[7]||(l[7]=a("hr",null,null,-1)),a("div",Z,[e.value.bulkAdd?r("",!0):(d(),_("div",ee,[o($,{saving:t.value,data:e.value,bulk:e.value.bulkAdd},null,8,["saving","data","bulk"])])),a("div",ae,[o(z,{saving:t.value,data:e.value},null,8,["saving","data"])]),a("div",le,[o(G,{saving:t.value,data:e.value},null,8,["saving","data"])]),e.value.bulkAdd?(d(),_("div",te,[a("div",se,[m(a("input",{class:"form-check-input",type:"checkbox",role:"switch","onUpdate:modelValue":l[1]||(l[1]=i=>e.value.preshared_key_bulkAdd=i),id:"bullAdd_PresharedKey_Switch",checked:""},null,512),[[B,e.value.preshared_key_bulkAdd]]),a("label",de,[a("small",oe,[o(n,{t:"Pre-Shared Key"}),l[6]||(l[6]=K()),e.value.preshared_key_bulkAdd?(d(),u(n,{key:0,t:"Enabled"})):(d(),u(n,{key:1,t:"Disabled"}))])])])])):r("",!0)]),l[8]||(l[8]=a("hr",null,null,-1)),P.value==="awg"?(d(),_("div",ne,[a("h5",null,[o(n,{t:"AmneziaWG Peer Setting"})]),a("div",null,[a("label",ie,[a("small",ue,[o(n,{t:"Advanced Security"})])]),a("div",re,[m(a("input",{type:"radio",class:"btn-check","onUpdate:modelValue":l[2]||(l[2]=i=>e.value.advanced_security=i),value:"on",name:"advanced_security_radio",id:"advanced_security_on",autocomplete:"off"},null,512),[[y,e.value.advanced_security]]),a("label",ce,[o(n,{t:"On"})]),m(a("input",{type:"radio","onUpdate:modelValue":l[3]||(l[3]=i=>e.value.advanced_security=i),value:"off",class:"btn-check",name:"advanced_security_radio",id:"advanced_security_off",autocomplete:"off"},null,512),[[y,e.value.advanced_security]]),a("label",ve,[o(n,{t:"Off"})])])])])):r("",!0),a("div",_e,[a("button",{class:"ms-auto btn btn-dark btn-brand rounded-3 px-3 py-2 shadow",disabled:!x.value||t.value,onClick:l[4]||(l[4]=i=>I())},[t.value?r("",!0):(d(),_("i",be)),t.value?(d(),u(n,{key:1,t:"Adding..."})):(d(),u(n,{key:2,t:"Add"}))],8,pe)])])])])])],512))}};export{he as default};
