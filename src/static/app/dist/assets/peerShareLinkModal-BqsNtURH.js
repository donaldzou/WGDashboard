import{_ as g,D as f,z as h,j as p,a,c as r,b as t,d as o,n as c,i as n,t as _,e as b}from"./index-c-1vvED5.js";import{d}from"./dayjs.min-BBJtjwQo.js";import{V as y}from"./vue-datepicker-QwerMWzf.js";import{L as S}from"./localeText-DR73fKoY.js";const k={name:"peerShareLinkModal",props:{selectedPeer:Object},components:{LocaleText:S,VueDatePicker:y},data(){return{dataCopy:void 0,loading:!1}},setup(){return{store:f()}},mounted(){this.dataCopy=JSON.parse(JSON.stringify(this.selectedPeer.ShareLink)).at(0)},watch:{"selectedPeer.ShareLink":{deep:!0,handler(e,s){s.length!==e.length&&(this.dataCopy=JSON.parse(JSON.stringify(this.selectedPeer.ShareLink)).at(0))}}},methods:{startSharing(){this.loading=!0,h("/api/sharePeer/create",{Configuration:this.selectedPeer.configuration.Name,Peer:this.selectedPeer.id,ExpireDate:d().add(7,"d").format("YYYY-MM-DD HH:mm:ss")},e=>{e.status?(this.selectedPeer.ShareLink=e.data,this.dataCopy=e.data.at(0)):this.store.newMessage("Server","Share link failed to create. Reason: "+e.message,"danger"),this.loading=!1})},updateLinkExpireDate(){h("/api/sharePeer/update",this.dataCopy,e=>{e.status?(this.dataCopy=e.data.at(0),this.selectedPeer.ShareLink=e.data,this.store.newMessage("Server","Link expire date updated","success")):this.store.newMessage("Server","Link expire date failed to update. Reason: "+e.message,"danger"),this.loading=!1})},stopSharing(){this.loading=!0,this.dataCopy.ExpireDate=d().format("YYYY-MM-DD HH:mm:ss"),this.updateLinkExpireDate()},parseTime(e){e?this.dataCopy.ExpireDate=d(e).format("YYYY-MM-DD HH:mm:ss"):this.dataCopy.ExpireDate=void 0,this.updateLinkExpireDate()}},computed:{getUrl(){const e=this.store.getActiveCrossServer();return e?`${e.host}/${this.$router.resolve({path:"/share",query:{ShareID:this.dataCopy.ShareID}}).href}`:window.location.origin+window.location.pathname+this.$router.resolve({path:"/share",query:{ShareID:this.dataCopy.ShareID}}).href}}},x={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll"},v={class:"container d-flex h-100 w-100"},C={class:"m-auto modal-dialog-centered dashboardModal",style:{width:"500px"}},D={class:"card rounded-3 shadow flex-grow-1"},w={class:"card-header bg-transparent d-flex align-items-center gap-2 border-0 p-4"},L={class:"mb-0"},P={key:0,class:"card-body px-4 pb-4"},M={key:0},Y={class:"mb-3 text-muted"},$=["disabled"],E={key:1},H={class:"d-flex gap-2 mb-4"},V=["href"],N={class:"d-flex flex-column gap-2 mb-3"},O=["disabled"];function T(e,s,U,B,I,m){const i=p("LocaleText"),u=p("VueDatePicker");return a(),r("div",x,[t("div",v,[t("div",C,[t("div",D,[t("div",w,[t("h4",L,[o(i,{t:"Share Peer"})]),t("button",{type:"button",class:"btn-close ms-auto",onClick:s[0]||(s[0]=l=>this.$emit("close"))})]),this.selectedPeer.ShareLink?(a(),r("div",P,[this.dataCopy?(a(),r("div",E,[t("div",H,[s[4]||(s[4]=t("i",{class:"bi bi-link-45deg"},null,-1)),t("a",{href:this.getUrl,class:"text-decoration-none",target:"_blank"},_(m.getUrl),9,V)]),t("div",N,[t("small",null,[s[5]||(s[5]=t("i",{class:"bi bi-calendar me-2"},null,-1)),o(i,{t:"Expire At"})]),o(u,{is24:!0,"min-date":new Date,"model-value":this.dataCopy.ExpireDate,"onUpdate:modelValue":this.parseTime,"time-picker-inline":"",format:"yyyy-MM-dd HH:mm:ss","preview-format":"yyyy-MM-dd HH:mm:ss",dark:this.store.Configuration.Server.dashboard_theme==="dark"},null,8,["min-date","model-value","onUpdate:modelValue","dark"])]),t("button",{onClick:s[2]||(s[2]=l=>this.stopSharing()),disabled:this.loading,class:"w-100 btn bg-danger-subtle text-danger-emphasis border-1 border-danger-subtle rounded-3 shadow-sm"},[t("span",{class:c({"animate__animated animate__flash animate__infinite animate__slower":this.loading})},s[6]||(s[6]=[t("i",{class:"bi bi-send-slash-fill me-2"},null,-1)]),2),this.loading?(a(),n(i,{key:0,t:"Stop Sharing..."})):(a(),n(i,{key:1,t:"Stop Sharing"}))],8,O)])):(a(),r("div",M,[t("h6",Y,[o(i,{t:"Currently the peer is not sharing"})]),t("button",{onClick:s[1]||(s[1]=l=>this.startSharing()),disabled:this.loading,class:"w-100 btn bg-success-subtle text-success-emphasis border-1 border-success-subtle rounded-3 shadow-sm"},[t("span",{class:c({"animate__animated animate__flash animate__infinite animate__slower":this.loading})},s[3]||(s[3]=[t("i",{class:"bi bi-send-fill me-2"},null,-1)]),2),this.loading?(a(),n(i,{key:0,t:"Sharing..."})):(a(),n(i,{key:1,t:"Start Sharing"}))],8,$)]))])):b("",!0)])])])])}const A=g(k,[["render",T]]);export{A as default};
